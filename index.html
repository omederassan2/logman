<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø³Ù†Ø¯Ø§Øª Ø§Ù„Ù‚Ø¨Ø¶</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            padding: 20px;
            background-color: #f0f4f8;
            color: #333;
        }

        .container {
            max-width: 600px;
            margin: 20px auto;
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        h2, h3 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        select, input {
            width: 100%;
            padding: 12px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 16px;
            margin-top: 8px;
            box-sizing: border-box;
        }

        button {
            background-color: #27ae60;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            transition: background 0.3s;
            margin-top: 10px;
        }

        button:hover {
            background-color: #219a52;
        }

        #message {
            text-align: center;
            margin-top: 15px;
            font-weight: bold;
            min-height: 24px;
        }

        .loading {
            color: #7f8c8d;
            font-style: italic;
        }

        .error {
            color: #e74c3c;
        }

        .success {
            color: #27ae60;
        }

        .info {
            color: #3498db;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Ø³Ù†Ø¯ Ù‚Ø¨Ø¶ - Ù„Ù‚Ù…Ø§Ù†: <span id="todayDay"></span></h2>

        <div class="form-group">
            <label for="note">Ù…Ù„Ø§Ø­Ø¸Ø© :</label>
            <input type="text" id="note" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø©">
        </div>

        <div class="form-group">
            <label for="clientSelect">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</label>
            <select id="clientSelect">
                <option value="">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡...</option>
            </select>
        </div>

        <div class="form-group">
            <label for="usd">Ù‚Ø¨Ø¶ Ø¯ÙˆÙ„Ø§Ø± ($):</label>
            <input type="number" id="usd" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±">
        </div>

        <div class="form-group">
            <label for="iqd">Ù‚Ø¨Ø¶ Ø¯ÙŠÙ†Ø§Ø± (IQD):</label>
            <input type="number" id="iqd" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø¯ÙŠÙ†Ø§Ø±">
        </div>

        <div class="form-group">
            <label for="exchangeRate">Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù:</label>
            <input type="number" id="exchangeRate" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø¯ÙŠÙ†Ø§Ø±">
        </div>

        <button onclick="validateAndSubmit()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø³Ù†Ø¯</button>
        <div id="message"></div>

        <div id="todayReceipts" style="margin-top: 30px;">
            <h3>Ø³Ù†Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
            <div id="receiptsList" class="info">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ù†Ø¯Ø§Øª...</div>
        </div>
    </div>

    <script>
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz6OnZfD95aB82l4Gb_ynXAUH_yrd_uqpM0xTuzAx8EWxcmBLrr4oe1XeHJR8w8CX3K/exec'; // â† Ø§Ø³ØªØ¨Ø¯Ù„ "Ù…Ø¹Ø±Ù-Ø§Ù„Ø³ÙƒØ±Ø¨Øª" Ø¨Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
        const daysArabic = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
        document.getElementById('todayDay').textContent = daysArabic[new Date().getDay()];

        async function loadClients() {
            try {
                const response = await fetch(`${GOOGLE_SCRIPT_URL}?action=getClients`);
                const data = await response.json();

                const select = document.getElementById('clientSelect');
                select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…...</option>';

                data.forEach(client => {
                    const option = document.createElement('option');
                    option.value = client.name;
                    option.textContent = client.name;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading clients:', error);
                showMessage('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', 'error');
            }
        }

        async function loadTodayReceipts() {
            try {
                const response = await fetch(`${GOOGLE_SCRIPT_URL}?action=getTodayReceipts`);
                const data = await response.json();

                const list = document.getElementById('receiptsList');

                if (data.length === 0) {
                    list.innerHTML = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ù†Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ….';
                    return;
                }

                list.innerHTML = data.map(r =>
                    `ğŸ’µ <strong>${r.client}</strong>: ${r.usd} Ø¯ÙˆÙ„Ø§Ø± - <em>Ù…Ù„Ø§Ø­Ø¸Ø©: ${r.note}</em>`
                ).join('<br>');
            } catch (error) {
                document.getElementById('receiptsList').textContent = 'ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø³Ù†Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…';
                console.error('Error loading today receipts:', error);
            }
        }

        async function validateAndSubmit() {
            const client = document.getElementById('clientSelect').value;
            const note = document.getElementById('note').value;
            const usd = document.getElementById('usd').value;
            const iqd = document.getElementById('iqd').value;
            const exchangeRate = document.getElementById('exchangeRate').value;

            if (!note.trim() && !client.trim()) {
                showMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ù„Ø§Ø­Ø¸Ø© Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
                return;
            }

            const formData = {
                client: client || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                note: note || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                usd: usd || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                iqd: iqd || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                exchangeRate: exchangeRate || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
            };

            try {
                showMessage('Ø¬Ø§Ø±Ù Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', 'loading');

                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData),
                    mode: 'no-cors',
                });

                showMessage('ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„', 'success');
                resetForm();
                loadTodayReceipts(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ù†Ø¯Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function resetForm() {
            document.getElementById('clientSelect').value = '';
            document.getElementById('usd').value = '';
            document.getElementById('iqd').value = '';
            document.getElementById('exchangeRate').value = '';
            document.getElementById('note').value = '';
        }

        function showMessage(text, type) {
            const msgDiv = document.getElementById('message');
            msgDiv.textContent = text;
            msgDiv.className = type;
            setTimeout(() => msgDiv.textContent = '', 5000);
        }

        window.onload = function () {
            loadClients();
            loadTodayReceipts();
        };
    </script>
</body>
</html>
